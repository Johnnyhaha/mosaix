# Mosaix - An iOS Photo Mosaic App
### Nathan Eliason & Shelly Bensal
<em>Updated April 24th, 2017 (Project Checkpoint)</em>

## Summary
______

We are creating an iOS application which uses the Metal framework to generate photo mosaics in parallel on-demand. Using the photos already in the device's Photo Library, Mosaix reconstructs the reference photo by selecting photos which match in color, shape, and contrast and placing them in a grid pattern representing the original image.

<p align="center">
  <img width="350" src="https://hunt.blob.core.windows.net/web-images/parallel/reference.png">
  <img height="260" width="350" src="https://hunt.blob.core.windows.net/web-images/parallel/composite.png"><br/>
  <em>A reference and composite comparison generated by our naive algorithm within the app from a photo library of just 4 photos.</em>
</p>

## Background
______
Our application is a Swift mobile app with a fairly simple user interface; the user selects the desired image (referred to as the _reference photo_) and adjust a few settings (grid size, image cropping, etc.). At this point, the application reassembles the selected image (into the _composite photo_) of the other images in the users' libraries, presenting the user with the _composite_ as a final result.

The most important -- and most parallelizable -- aspect of this project is the fitting of images to different sections of the reference photo. This operation is highly parallelizable as sections of the reference photo are fairly independent.


## The Challenge
______
 - While each square section of the reference photo is in itself independent, communication between selections of adjacent squares are important for flow in the overall image -- it will be important to select photos that don't contrast highly along the seams between photos in order for the reference photo to be visible from the composite image.
 - Additionally, communication between selections of similar colors, shapes, and contrast patterns is incredibly important as we are choosing not to use the same source photo twice within the composite image. For example, a reference photo with a solid blue sky could very easily match the same photo across a major portion of the gridspace if there was no communication between selection in that region.


## Resources
______
We'll be writing the app from scratch in Swift, with the exception of our usage of the Metal framework for low-level GPU access. We're still researching the algorithmic approach to this problem and will likely implement numerous known photo-processing algorithms in our attempt to find the most efficient solution.


## Goals & Deliverables
______

After creating the application that can display composite images based on the algorithmic selection and the general user interface, we'll implement the selection algorithm twice -- once naively on Metal and once as our optimized alternative. As we refine our parallel algorithm according to the tiered goals below, we'll adjust the naive solution so that the two solve the same problem (ex: duplicate source image avoidance). We'll present the user with a toggle-switch to change between the naive solution and our optimized algorithm within the app.

#### What We've Done
 - Full graphic user interface with automatic photo library access and an in-app camera and photo selector.
 - Adjustable grid size and final quality -- letting the user select how large each source image is framed within the final composite photo and how picky the algorithm is in its selection.
 - Implemented naive and basic parallel photo selection algorithms.

#### Plan to Achieve
 - Finish implementing the Metal kernel
 - Pre-processing of the device's Photo Library that reduces complexity and time of the generation of each individual mosaic.
 - We plan to achieve performance that improves upon existing solutions in the app store. While there are a few apps already that perform similar functions to Mosaix, they consume 30-40s per image to finish processing (depending on grid size and quality).
 - Video processing (frame-by-frame mosaic generation and fluid playback).
 - A job queue for videos and large photos.
 
#### Nice-to-Haves
 - Source photo cropping and resizing for framing within the composite image.
 - Imperfect grids (patchwork patterns for selection).

#### Demo
 - We will be able to demonstrate the app live on an iPhone. We can demonstrate Mosaix by taking a picture live and have the application generate a composite mosaic of that image on the spot.
 
## Concerns
______
 - We're making slow and steady progress on the application itself, but we've operated up to this point with very little feedback on our ideas so far. We'll make an effort to reach out to course staff in the next week to confirm that we're on-track.

## Platform Choice
______
Mosaix makes the most sense on a mobile device because that's the platform on which a majority of our everday photos are taken and stored. Creating a mobile app makes it easy for the end user to take a photo and see a live result, and makes sharing the composite image much simpler. 

In particular, our choice of iOS 10 on iPhone 7 is driven mostly by the inclusion of the Metal framework, which will give us unprecendented low-level access to the GPU on the iPhone 7. Not only was the hardware specifically designed with photo processing in mind, but the software gives us complete control over multi-threading and image processing and a simple way of accessing a library of existing photos.


## Schedule
______

| Date | Task | Status
|-----|-----|-----|
| Friday, April 14th | Implement a simple GUI for the application that can access the Photo Library and display composite images according to a naive selection algorithm. | Done
| Wednesday, April 19th | A basic parallel algorithm for source photo selection implemented on the Metal framework working alongside the naive algorithm for composition. | Done
| Tuesday, April 25th | Finish the reasonable Metal implementation for library pre-processing | In-Progress (Nathan)
| | User-controllable switch between the two algorithms | Assigned (Shelly)
| Friday, April 28th | Optimize library pre-processing for storing and loading to file, finding and processing new photos | Assigned (Shelly)
| | Optimize Metal kernel for processing 10-point average of photos | Assigned (Nathan)
| Monday, May 1st | Implement adjustable grid size and composite image quality. | Done
| | Saving and loading adjustable grid size and composite image quality. | Assigned (Shelly)
| | Fix selection bugs (color-flipping and unwanted image translations on canvas) | Assigned (Nathan)
Friday, May 5th | Implement more advanced features and work on stretch goals (source photo adjustments, video processing, imperfect grids, etc.). | Both
Tuesday, May 9th | Complete all functionality of the Mosaix application. Begin work on the project video. | Both
Friday, May 12th | Submit final project and video. | Both
